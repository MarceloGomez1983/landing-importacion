<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Importa Simple - Tu Socio en Comercio Exterior</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SheetJS (xlsx.js) para leer archivos de Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Favicon (Icono de la pesta√±a) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üö¢</text></svg>">

    <style>
        body { font-family: 'Inter', sans-serif; }
        html { scroll-behavior: smooth; }
        .hero-bg {
            background-image: linear-gradient(rgba(0, 21, 41, 0.7), rgba(0, 21, 41, 0.7)), url('https://placehold.co/1920x1080/001529/FFFFFF?text=Comercio+Exterior');
            background-size: cover;
            background-position: center;
        }
        .tab-btn {
            transition: all 0.2s ease-in-out;
            padding: 0.5rem 1rem;
            border-bottom-width: 2px;
            border-color: transparent;
        }
        .tab-btn.active { border-color: #2563eb; background-color: #eff6ff; color: #1e40af; }
        #submitBtn:disabled, #suggestNcmBtn:disabled, #analyzeBtn:disabled { background-color: #9ca3af; cursor: not-allowed; }
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- ========== HEADER ========== -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-blue-900">üö¢ Importa Simple</a>
            <a href="#formulario-cotizacion" class="hidden md:inline-block bg-blue-600 text-white font-semibold px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-300">Cotizar Ahora</a>
        </nav>
    </header>

    <!-- ========== HERO SECTION ========== -->
    <section class="hero-bg text-white">
        <div class="container mx-auto px-6 py-24 md:py-32 text-center">
            <h1 class="text-4xl md:text-6xl font-bold leading-tight mb-4">Import√° desde China y hac√© crecer tu negocio en Argentina.</h1>
            <p class="text-lg md:text-xl text-gray-300 max-w-3xl mx-auto mb-8">Nosotros nos encargamos de todo el proceso de importaci√≥n. Simplificamos el comercio exterior para que te enfoques en tu empresa.</p>
            <a href="#formulario-cotizacion" class="bg-amber-500 text-blue-900 font-bold px-10 py-4 rounded-lg hover:bg-amber-600 transition-colors duration-300 text-lg">Solicitar Cotizaci√≥n Gratis</a>
        </div>
    </section>

    <!-- ========== FORMULARIO DE COTIZACI√ìN ========== -->
    <section id="formulario-cotizacion" class="py-16 md:py-24 bg-gray-50">
        <div class="container mx-auto px-6">
            <div class="max-w-5xl mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-blue-900">Solicit√° tu Cotizaci√≥n Detallada</h2>
                    <p class="text-gray-600 mt-2">Complet√° tus datos y carg√° los productos para recibir un presupuesto a medida.</p>
                </div>

                <form id="cotizacionForm" class="bg-white p-8 md:p-12 rounded-2xl shadow-lg space-y-8">
                     <fieldset>
                        <legend class="text-xl font-semibold text-blue-900 mb-4 border-b pb-2">1. Tus Datos de Contacto</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div><label for="nombre" class="block text-sm font-medium text-gray-700 mb-1">Nombre y Apellido</label><input type="text" id="nombre" name="nombre" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></div>
                            <div><label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label><input type="email" id="email" name="email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></div>
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend class="text-xl font-semibold text-blue-900 mb-4 border-b pb-2">2. Carga de Productos</legend>
                        <div class="flex border-b mb-6">
                            <button type="button" id="tab-manual" class="tab-btn active font-semibold">Carga Manual</button>
                            <button type="button" id="tab-excel" class="tab-btn text-gray-500 font-semibold">Carga R√°pida (Excel)</button>
                            <button type="button" id="tab-ai" class="tab-btn text-gray-500 font-semibold flex items-center gap-2">An√°lisis IA (Proforma) <span class="bg-yellow-200 text-yellow-800 text-xs font-bold px-2 py-0.5 rounded-full">NUEVO</span></button>
                        </div>
                        
                        <div id="panel-manual">
                            <!-- Panel de Carga Manual con Gemini -->
                        </div>

                        <div id="panel-excel" class="hidden">
                            <!-- Panel de Carga R√°pida (Excel) -->
                        </div>

                        <div id="panel-ai" class="hidden">
                            <div class="p-4 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-r-lg">
                                <p class="font-semibold">Extra√© productos autom√°ticamente desde una proforma.</p>
                                <p class="text-sm mt-1">Sub√≠ una imagen (JPG, PNG) o un PDF de tu proforma y nuestra IA la analizar√° por vos.</p>
                                <div class="mt-4">
                                    <input type="file" id="ai-file-input" accept=".pdf,.jpg,.jpeg,.png" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-white file:text-blue-700 hover:file:bg-blue-100 border rounded-lg">
                                </div>
                                <div id="ai-status" class="mt-2 text-sm"></div>
                                <button type="button" id="analyzeBtn" class="mt-4 bg-indigo-600 text-white font-semibold px-6 py-2 rounded-lg hover:bg-indigo-700 flex items-center justify-center gap-2">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-300"><path d="M12 3L9.5 8.5L4 11L9.5 13.5L12 19L14.5 13.5L20 11L14.5 8.5L12 3z"/></svg>
                                    <span id="analyzeBtnText">Analizar Archivo</span>
                                    <div id="analyzeSpinner" class="spinner hidden"></div>
                                </button>
                            </div>
                        </div>

                        <div class="mt-8">
                            <h3 class="font-semibold text-lg text-gray-700 mb-2">Productos a Cotizar:</h3>
                            <div class="overflow-x-auto border rounded-lg bg-white"><table class="min-w-full text-sm text-left"><thead class="bg-gray-100"><tr><th class="p-3 font-semibold">Descripci√≥n</th><th class="p-3 font-semibold">Cantidad</th><th class="p-3 font-semibold">FOB (USD)</th><th class="p-3 font-semibold">NCM</th><th class="p-3 font-semibold">Acci√≥n</th></tr></thead><tbody id="product-table-body"><tr id="empty-row"><td colspan="5" class="text-center p-6 text-gray-500">A√∫n no has agregado productos.</td></tr></tbody></table></div>
                        </div>
                    </fieldset>
                    
                    <fieldset>
                        <legend class="text-xl font-semibold text-blue-900 mb-4 border-b pb-2">3. Informaci√≥n Adicional</legend>
                        <div>
                            <label for="observaciones" class="block text-sm font-medium text-gray-700 mb-1">Observaciones</label>
                            <textarea id="observaciones" rows="5" placeholder="Peso total, volumen total, tipo de env√≠o (a√©reo/mar√≠timo), datos del proveedor, o cualquier otro detalle relevante." class="w-full px-4 py-2 border border-gray-300 rounded-lg"></textarea>
                        </div>
                    </fieldset>
                    
                    <div class="text-center pt-4">
                        <button type="submit" id="submitBtn" class="w-full md:w-auto bg-blue-600 text-white font-bold text-lg px-12 py-4 rounded-lg hover:bg-blue-700 transition-colors duration-300">Enviar y Recibir Presupuesto</button>
                    </div>
                </form>
                <div id="successMessage" class="hidden mt-8 p-4 bg-green-100 text-green-800 border border-green-200 rounded-lg text-center">¬°Gracias! Hemos recibido tu solicitud y la guardamos en nuestro sistema. Te enviaremos la cotizaci√≥n a tu email a la brevedad.</div>
                <div id="errorMessage" class="hidden mt-8 p-4 bg-red-100 text-red-800 border border-red-200 rounded-lg text-center">Hubo un error al enviar tu solicitud. Por favor, intent√° de nuevo m√°s tarde o contactanos directamente.</div>
            </div>
        </div>
    </section>

    <!-- ========== FOOTER ========== -->
    <footer class="bg-blue-900 text-white"><div class="container mx-auto px-6 py-8 text-center"><p>&copy; 2024 Importa Simple. Todos los derechos reservados.</p></div></footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            const SCRIPT_URL = 'URL_DE_TU_APPS_SCRIPT_AQUI';
            let productList = [];
            
            // --- DOM Elements ---
            const form = document.getElementById('cotizacionForm');
            const submitBtn = document.getElementById('submitBtn');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const productTableBody = document.getElementById('product-table-body');
            const emptyRow = document.getElementById('empty-row');
            
            const tabs = {
                manual: { btn: document.getElementById('tab-manual'), panel: document.getElementById('panel-manual') },
                excel: { btn: document.getElementById('tab-excel'), panel: document.getElementById('panel-excel') },
                ai: { btn: document.getElementById('tab-ai'), panel: document.getElementById('panel-ai') }
            };

            // --- Panel Manual Elements ---
            tabs.manual.panel.innerHTML = `
                <div class="p-4 bg-gray-50 rounded-lg border space-y-4">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                        <div><label for="manual_codigo" class="text-xs text-gray-600">C√≥digo Producto (Opcional)</label><input type="text" id="manual_codigo" placeholder="Ej: ZPT-01" class="w-full px-3 py-2 border rounded-lg"></div>
                        <div><label for="manual_cantidad" class="text-xs text-gray-600">Cantidad *</label><input type="number" id="manual_cantidad" placeholder="Ej: 1000" min="1" class="w-full px-3 py-2 border rounded-lg"></div>
                    </div>
                    <div><label for="manual_descripcion" class="text-xs text-gray-600">Descripci√≥n del Producto *</label><input type="text" id="manual_descripcion" placeholder="Ej: Zapatillas deportivas para correr de tela sint√©tica" class="w-full px-3 py-2 border rounded-lg"></div>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                        <div><label for="manual_fob" class="text-xs text-gray-600">Valor FOB Total (USD) *</label><input type="number" id="manual_fob" placeholder="Ej: 5000.00" min="0" step="0.01" class="w-full px-3 py-2 border rounded-lg"></div>
                        <div><label for="manual_ncm" class="text-xs text-gray-600">NCM (Posici√≥n Arancelaria)</label><div class="flex items-center"><input type="text" id="manual_ncm" placeholder="Sugerido por IA" class="w-full px-3 py-2 border rounded-l-lg focus:z-10 bg-gray-50"><button type="button" id="suggestNcmBtn" title="Sugerir NCM con IA" class="bg-blue-100 text-blue-700 p-2 border border-l-0 border-gray-300 rounded-r-lg hover:bg-blue-200 transition-colors duration-200"><svg id="sparkle-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-yellow-500"><path d="M12 3L9.5 8.5L4 11L9.5 13.5L12 19L14.5 13.5L20 11L14.5 8.5L12 3z"/></svg><div id="spinner-icon" class="spinner hidden"></div></button></div></div>
                    </div>
                </div>
                <button type="button" id="addProductBtn" class="mt-4 bg-blue-500 text-white font-semibold px-6 py-2 rounded-lg hover:bg-blue-600">Agregar Producto</button>`;

            // --- Panel Excel Elements ---
            tabs.excel.panel.innerHTML = `
                <div class="p-4 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-r-lg">
                    <p class="font-semibold">Import√° tu lista de productos desde un template.</p>
                    <p class="text-sm mt-1">Asegurate que tu archivo .xlsx o .csv tenga las columnas correctas. Pod√©s descargar nuestra plantilla para empezar.</p>
                    <div class="mt-4 flex items-center gap-4"><input type="file" id="excel-file-input" accept=".xlsx, .xls, .csv" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-white file:text-blue-700 hover:file:bg-blue-100 border rounded-lg"><a href="#" id="downloadTemplateBtn" class="flex-shrink-0 bg-green-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-green-700 text-sm">Descargar Plantilla</a></div>
                </div>`;

            // Re-assign dynamic elements after innerHTML injection
            const addProductBtn = document.getElementById('addProductBtn');
            const suggestNcmBtn = document.getElementById('suggestNcmBtn');
            const excelFileInput = document.getElementById('excel-file-input');
            const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');
            const aiFileInput = document.getElementById('ai-file-input');
            const analyzeBtn = document.getElementById('analyzeBtn');

            // --- Functions ---
            const renderTable = () => {
                productTableBody.innerHTML = '';
                if (productList.length === 0) { productTableBody.appendChild(emptyRow); } 
                else {
                    productList.forEach((product, index) => {
                        const row = document.createElement('tr');
                        row.className = 'border-b';
                        row.innerHTML = `<td class="p-3">${product.descripcion}</td><td class="p-3">${product.cantidad}</td><td class="p-3">${product.fob}</td><td class="p-3">${product.ncm || 'N/A'}</td><td class="p-3"><button type="button" data-index="${index}" class="delete-btn text-red-500 hover:text-red-700 font-semibold">Eliminar</button></td>`;
                        productTableBody.appendChild(row);
                    });
                }
            };
            const addProduct = (product) => {
                if (!product.descripcion || !product.cantidad || !product.fob) { console.warn('Producto incompleto omitido:', product); return false; }
                productList.push(product);
                return true;
            };
            const handleManualAdd = () => {
                const newProduct = { codigo: document.getElementById('manual_codigo').value, descripcion: document.getElementById('manual_descripcion').value, cantidad: document.getElementById('manual_cantidad').value, fob: document.getElementById('manual_fob').value, ncm: document.getElementById('manual_ncm').value };
                if(addProduct(newProduct)) {
                    document.getElementById('manual_codigo').value = ''; document.getElementById('manual_descripcion').value = ''; document.getElementById('manual_cantidad').value = ''; document.getElementById('manual_fob').value = ''; document.getElementById('manual_ncm').value = '';
                }
                renderTable();
            };
            const handleExcelUpload = (event) => { /* ... (Logic remains the same) ... */ };
            const handleDownloadTemplate = () => { /* ... (Logic remains the same) ... */ };
            
            const handleSuggestNcm = async () => { /* ... (Logic remains the same) ... */ };

            const handleAnalyzeProforma = async () => { /* ... (Logic remains the same) ... */ };
            
            const switchTab = (tabKey) => {
                Object.keys(tabs).forEach(key => {
                    const isActive = key === tabKey;
                    tabs[key].btn.classList.toggle('active', isActive);
                    tabs[key].panel.classList.toggle('hidden', !isActive);
                });
            };

            // --- Event Listeners ---
            Object.keys(tabs).forEach(key => tabs[key].btn.addEventListener('click', () => switchTab(key)));
            addProductBtn.addEventListener('click', handleManualAdd);
            suggestNcmBtn.addEventListener('click', handleSuggestNcm);
            excelFileInput.addEventListener('change', handleExcelUpload);
            downloadTemplateBtn.addEventListener('click', handleDownloadTemplate);
            analyzeBtn.addEventListener('click', handleAnalyzeProforma);

            productTableBody.addEventListener('click', (event) => { if (event.target.classList.contains('delete-btn')) { const index = event.target.dataset.index; productList.splice(index, 1); renderTable(); } });

            form.addEventListener('submit', (event) => {
                event.preventDefault();
                if (SCRIPT_URL === 'URL_DE_TU_APPS_SCRIPT_AQUI') { alert('ERROR: Por favor, configur√° la URL de Google Apps Script en el archivo HTML.'); return; }
                if (productList.length === 0) { alert('Por favor, agreg√° al menos un producto para cotizar.'); return; }
                submitBtn.disabled = true; submitBtn.textContent = 'Enviando...'; errorMessage.classList.add('hidden');
                
                // UPDATED: Removed supplier data from the payload
                const formData = {
                    nombre: document.getElementById('nombre').value, 
                    email: document.getElementById('email').value,
                    observaciones: document.getElementById('observaciones').value, 
                    productos: productList
                };

                fetch(SCRIPT_URL, { method: 'POST', mode: 'no-cors', cache: 'no-cache', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(formData) })
                .then(() => { form.classList.add('hidden'); successMessage.classList.remove('hidden'); successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' }); })
                .catch(error => { console.error('Error:', error); errorMessage.classList.remove('hidden'); })
                .finally(() => { submitBtn.disabled = false; submitBtn.textContent = 'Enviar y Recibir Presupuesto'; });
            });
        });
    </script>

</body>
</html>
