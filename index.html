<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Importate - Tu Socio en Comercio Exterior</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SheetJS (xlsx.js) para leer archivos de Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <!-- Favicon (Icono de la pestaña) -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🚢</text></svg>">

    <style>
        body { font-family: 'Inter', sans-serif; }
        html { scroll-behavior: smooth; }
        .hero-bg {
            background-image: linear-gradient(rgba(0, 21, 41, 0.7), rgba(0, 21, 41, 0.7)), url('https://placehold.co/1920x1080/001529/FFFFFF?text=Comercio+Exterior');
            background-size: cover;
            background-position: center;
        }
        .tab-btn.active { border-color: #2563eb; background-color: #eff6ff; color: #1e40af; }
        /* Estilo para el botón de carga */
        #submitBtn:disabled { background-color: #9ca3af; cursor: not-allowed; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <!-- ========== HEADER ========== -->
    <header class="bg-white/80 backdrop-blur-md sticky top-0 z-50 shadow-sm">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-blue-900">🚢 Importa Simple</a>
            <a href="#formulario-cotizacion" class="hidden md:inline-block bg-blue-600 text-white font-semibold px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors duration-300">Cotizar Ahora</a>
        </nav>
    </header>

    <!-- ========== HERO SECTION ========== -->
    <section class="hero-bg text-white">
        <div class="container mx-auto px-6 py-24 md:py-32 text-center">
            <h1 class="text-4xl md:text-6xl font-bold leading-tight mb-4">Importá desde China y hacé crecer tu negocio en Argentina.</h1>
            <p class="text-lg md:text-xl text-gray-300 max-w-3xl mx-auto mb-8">Nosotros nos encargamos de todo el proceso de importación. Simplificamos el comercio exterior para que te enfoques en tu empresa.</p>
            <a href="#formulario-cotizacion" class="bg-amber-500 text-blue-900 font-bold px-10 py-4 rounded-lg hover:bg-amber-600 transition-colors duration-300 text-lg">Solicitar Cotización Gratis</a>
        </div>
    </section>

    <!-- ========== FORMULARIO DE COTIZACIÓN ========== -->
    <section id="formulario-cotizacion" class="py-16 md:py-24 bg-gray-50">
        <div class="container mx-auto px-6">
            <div class="max-w-5xl mx-auto">
                <div class="text-center mb-12">
                    <h2 class="text-3xl md:text-4xl font-bold text-blue-900">Solicitá tu Cotización Detallada</h2>
                    <p class="text-gray-600 mt-2">Completá tus datos y cargá los productos para recibir un presupuesto a medida.</p>
                </div>

                <form id="cotizacionForm" class="bg-white p-8 md:p-12 rounded-2xl shadow-lg space-y-8">
                     <fieldset>
                        <legend class="text-xl font-semibold text-blue-900 mb-4 border-b pb-2">1. Tus Datos de Contacto</legend>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div><label for="nombre" class="block text-sm font-medium text-gray-700 mb-1">Nombre y Apellido</label><input type="text" id="nombre" name="nombre" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></div>
                            <div><label for="email" class="block text-sm font-medium text-gray-700 mb-1">Email</label><input type="email" id="email" name="email" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500"></div>
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend class="text-xl font-semibold text-blue-900 mb-4 border-b pb-2">2. Carga de Productos</legend>
                        <div class="flex border-b mb-6"><button type="button" id="tab-manual" class="tab-btn active font-semibold py-2 px-4 border-b-2">Carga Manual</button><button type="button" id="tab-excel" class="tab-btn text-gray-500 font-semibold py-2 px-4 border-b-2 border-transparent">Carga por Excel</button></div>
                        <div id="panel-manual">
                            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-4 p-4 bg-gray-50 rounded-lg border"><input type="text" id="manual_codigo" placeholder="Código Producto" class="w-full px-3 py-2 border rounded-lg"><input type="text" id="manual_descripcion" placeholder="Descripción *" class="w-full px-3 py-2 border rounded-lg md:col-span-2 lg:col-span-1"><input type="number" id="manual_cantidad" placeholder="Cantidad *" min="1" class="w-full px-3 py-2 border rounded-lg"><input type="number" id="manual_fob" placeholder="Valor FOB (USD) *" min="0" step="0.01" class="w-full px-3 py-2 border rounded-lg"><input type="text" id="manual_ncm" placeholder="NCM" class="w-full px-3 py-2 border rounded-lg"></div>
                            <button type="button" id="addProductBtn" class="bg-blue-500 text-white font-semibold px-6 py-2 rounded-lg hover:bg-blue-600">Agregar Producto</button>
                        </div>
                        <div id="panel-excel" class="hidden">
                            <div class="p-4 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-r-lg">
                                <p class="font-semibold">¡Importá tu lista de productos fácilmente!</p>
                                <p class="text-sm mt-1">Asegurate que tu archivo .xlsx o .csv tenga las columnas correctas. Podés descargar nuestra plantilla para empezar.</p>
                                <div class="mt-4 flex items-center gap-4"><input type="file" id="excel-file-input" accept=".xlsx, .xls, .csv" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:text-sm file:font-semibold file:bg-white file:text-blue-700 hover:file:bg-blue-100 border rounded-lg"><a href="#" id="downloadTemplateBtn" class="flex-shrink-0 bg-green-600 text-white font-semibold px-4 py-2 rounded-lg hover:bg-green-700 text-sm">Descargar Plantilla</a></div>
                            </div>
                        </div>
                        <div class="mt-8">
                            <h3 class="font-semibold text-lg text-gray-700 mb-2">Productos a Cotizar:</h3>
                            <div class="overflow-x-auto border rounded-lg bg-white"><table class="min-w-full text-sm text-left"><thead class="bg-gray-100"><tr><th class="p-3 font-semibold">Descripción</th><th class="p-3 font-semibold">Cantidad</th><th class="p-3 font-semibold">FOB (USD)</th><th class="p-3 font-semibold">NCM</th><th class="p-3 font-semibold">Acción</th></tr></thead><tbody id="product-table-body"><tr id="empty-row"><td colspan="5" class="text-center p-6 text-gray-500">Aún no has agregado productos.</td></tr></tbody></table></div>
                        </div>
                    </fieldset>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <fieldset>
                            <legend class="text-xl font-semibold text-blue-900 mb-4 border-b pb-2">3. Datos del Proveedor</legend>
                            <div class="space-y-4"><div><label for="proveedor_razon_social" class="block text-sm font-medium text-gray-700 mb-1">Razón Social</label><input type="text" id="proveedor_razon_social" class="w-full px-4 py-2 border border-gray-300 rounded-lg"></div><div><label for="proveedor_contacto" class="block text-sm font-medium text-gray-700 mb-1">Contacto</label><input type="text" id="proveedor_contacto" class="w-full px-4 py-2 border border-gray-300 rounded-lg"></div></div>
                        </fieldset>
                        <fieldset>
                            <legend class="text-xl font-semibold text-blue-900 mb-4 border-b pb-2">4. Información Adicional</legend>
                            <div><label for="observaciones" class="block text-sm font-medium text-gray-700 mb-1">Observaciones</label><textarea id="observaciones" rows="5" placeholder="Peso, volumen, tipo de envío (aéreo/marítimo), etc." class="w-full px-4 py-2 border border-gray-300 rounded-lg"></textarea></div>
                        </fieldset>
                    </div>
                    <div class="text-center pt-4">
                        <button type="submit" id="submitBtn" class="w-full md:w-auto bg-blue-600 text-white font-bold text-lg px-12 py-4 rounded-lg hover:bg-blue-700 transition-colors duration-300">Enviar y Recibir Presupuesto</button>
                    </div>
                </form>
                <div id="successMessage" class="hidden mt-8 p-4 bg-green-100 text-green-800 border border-green-200 rounded-lg text-center">¡Gracias! Hemos recibido tu solicitud y la guardamos en nuestro sistema. Te enviaremos la cotización a tu email a la brevedad.</div>
                <div id="errorMessage" class="hidden mt-8 p-4 bg-red-100 text-red-800 border border-red-200 rounded-lg text-center">Hubo un error al enviar tu solicitud. Por favor, intentá de nuevo más tarde o contactanos directamente.</div>
            </div>
        </div>
    </section>

    <!-- ========== FOOTER ========== -->
    <footer class="bg-blue-900 text-white"><div class="container mx-auto px-6 py-8 text-center"><p>&copy; 2024 Importa Simple. Todos los derechos reservados.</p></div></footer>

    <script>
        // =================================================================================
        // SCRIPT PARA LA LANDING PAGE DE IMPORTACIÓN CON CONEXIÓN A GOOGLE SHEETS
        // =================================================================================
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- CONFIGURACIÓN ---
            // ¡IMPORTANTE! Pegá aquí la URL de tu aplicación web de Google Apps Script.
            const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyGYpHWnMkwsiTYlpDRMuWRP_18y3IAvxZpPuUmLpdwtn6T8NJawt_Wd9wxrsGqWI6H/exec";

            // --- STATE ---
            let productList = [];

            // --- DOM ELEMENTS ---
            const form = document.getElementById('cotizacionForm');
            const submitBtn = document.getElementById('submitBtn');
            const successMessage = document.getElementById('successMessage');
            const errorMessage = document.getElementById('errorMessage');
            const addProductBtn = document.getElementById('addProductBtn');
            const productTableBody = document.getElementById('product-table-body');
            const emptyRow = document.getElementById('empty-row');
            const excelFileInput = document.getElementById('excel-file-input');
            const downloadTemplateBtn = document.getElementById('downloadTemplateBtn');
            const tabManual = document.getElementById('tab-manual');
            const tabExcel = document.getElementById('tab-excel');
            const panelManual = document.getElementById('panel-manual');
            const panelExcel = document.getElementById('panel-excel');

            // --- FUNCTIONS ---
            const renderTable = () => {
                productTableBody.innerHTML = '';
                if (productList.length === 0) { productTableBody.appendChild(emptyRow); } 
                else {
                    productList.forEach((product, index) => {
                        const row = document.createElement('tr');
                        row.className = 'border-b';
                        row.innerHTML = `<td class="p-3">${product.descripcion}</td><td class="p-3">${product.cantidad}</td><td class="p-3">${product.fob}</td><td class="p-3">${product.ncm || 'N/A'}</td><td class="p-3"><button type="button" data-index="${index}" class="delete-btn text-red-500 hover:text-red-700 font-semibold">Eliminar</button></td>`;
                        productTableBody.appendChild(row);
                    });
                }
            };
            const addProduct = (product) => {
                if (!product.descripcion || !product.cantidad || !product.fob) { alert('Por favor, completá Descripción, Cantidad y Valor FOB.'); return; }
                productList.push(product);
                renderTable();
            };
            const handleManualAdd = () => {
                const newProduct = { codigo: document.getElementById('manual_codigo').value, descripcion: document.getElementById('manual_descripcion').value, cantidad: document.getElementById('manual_cantidad').value, fob: document.getElementById('manual_fob').value, ncm: document.getElementById('manual_ncm').value };
                addProduct(newProduct);
                document.getElementById('manual_codigo').value = ''; document.getElementById('manual_descripcion').value = ''; document.getElementById('manual_cantidad').value = ''; document.getElementById('manual_fob').value = ''; document.getElementById('manual_ncm').value = '';
            };
            const handleExcelUpload = (event) => {
                const file = event.target.files[0]; if (!file) return;
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const data = new Uint8Array(e.target.result); const workbook = XLSX.read(data, { type: 'array' }); const sheetName = workbook.SheetNames[0]; const worksheet = workbook.Sheets[sheetName]; const json = XLSX.utils.sheet_to_json(worksheet);
                        if (json.length === 0) { alert('El archivo Excel está vacío o tiene un formato incorrecto.'); return; }
                        const newProducts = json.map(row => ({ codigo: row['Codigo Producto'], descripcion: row['Descripcion'], cantidad: row['Cantidad'], fob: row['Valor FOB (USD)'], ncm: row['NCM'] }));
                        productList = [...productList, ...newProducts]; renderTable(); alert(`${newProducts.length} productos fueron agregados exitosamente.`);
                    } catch (error) { console.error("Error processing Excel file:", error); alert("Hubo un error al procesar el archivo. Asegurate que el formato sea el correcto."); }
                };
                reader.readAsArrayBuffer(file); excelFileInput.value = '';
            };
            const handleDownloadTemplate = () => { const headers = ["Codigo Producto", "Descripcion", "Cantidad", "Valor FOB (USD)", "NCM"]; const csvContent = "data:text/csv;charset=utf-8," + headers.join(",") + "\n"; const encodedUri = encodeURI(csvContent); const link = document.createElement("a"); link.setAttribute("href", encodedUri); link.setAttribute("download", "plantilla_importacion.csv"); document.body.appendChild(link); link.click(); document.body.removeChild(link); };
            const switchTab = (tab) => { if (tab === 'manual') { tabManual.classList.add('active'); tabExcel.classList.remove('active'); panelManual.classList.remove('hidden'); panelExcel.classList.add('hidden'); } else { tabExcel.classList.add('active'); tabManual.classList.remove('active'); panelExcel.classList.remove('hidden'); panelManual.classList.add('hidden'); } };

            // --- EVENT LISTENERS ---
            addProductBtn.addEventListener('click', handleManualAdd);
            excelFileInput.addEventListener('change', handleExcelUpload);
            downloadTemplateBtn.addEventListener('click', handleDownloadTemplate);
            tabManual.addEventListener('click', () => switchTab('manual'));
            tabExcel.addEventListener('click', () => switchTab('excel'));
            productTableBody.addEventListener('click', (event) => { if (event.target.classList.contains('delete-btn')) { const index = event.target.dataset.index; productList.splice(index, 1); renderTable(); } });

            // --- FORM SUBMISSION LOGIC (UPDATED) ---
            form.addEventListener('submit', (event) => {
                event.preventDefault();
                
                if (SCRIPT_URL === 'URL_DE_TU_APPS_SCRIPT_AQUI') {
                    alert('ERROR: Por favor, configurá la URL de Google Apps Script en el archivo HTML.');
                    return;
                }
                if (productList.length === 0) {
                    alert('Por favor, agregá al menos un producto para cotizar.');
                    return;
                }

                // Deshabilitar botón y mostrar estado de carga
                submitBtn.disabled = true;
                submitBtn.textContent = 'Enviando...';
                errorMessage.classList.add('hidden');

                const formData = {
                    nombre: document.getElementById('nombre').value,
                    email: document.getElementById('email').value,
                    proveedor: {
                        razonSocial: document.getElementById('proveedor_razon_social').value,
                        contacto: document.getElementById('proveedor_contacto').value,
                    },
                    observaciones: document.getElementById('observaciones').value,
                    productos: productList
                };

                // Enviar datos a Google Apps Script
                fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // 'no-cors' es necesario para Apps Script, aunque no podremos leer la respuesta directa.
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                })
                .then(() => {
                    // Como usamos 'no-cors', la respuesta será "opaca". No podemos leer si fue éxito o error.
                    // Asumimos éxito si la solicitud no falló en la red.
                    form.classList.add('hidden');
                    successMessage.classList.remove('hidden');
                    successMessage.scrollIntoView({ behavior: 'smooth', block: 'center' });
                })
                .catch(error => {
                    console.error('Error:', error);
                    errorMessage.classList.remove('hidden');
                })
                .finally(() => {
                    // Volver a habilitar el botón en caso de error para que puedan reintentar.
                    submitBtn.disabled = false;
                    submitBtn.textContent = 'Enviar y Recibir Presupuesto';
                });
            });
        });
    </script>

</body>
</html>
